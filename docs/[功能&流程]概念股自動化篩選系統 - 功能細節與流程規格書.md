# \[功能&流程\]概念股自動化篩選系統 - 功能細節與流程規格書

## 1\.0 總覽 (Overview)

### 1\.1 專案目標與使命

根據市場數據，近五年台灣投資人對「題材股」的興趣顯著提升，Google 搜尋指數成長了 100%。然而，散戶投資者普遍面臨四大痛點：**資訊即時性不足**、**概念定義缺乏標準**、**手動維護成本高昂**，以及**專業工具入門門檻高**。 

為此，我們的使命是打造一個**「免登入、三秒內回應」的 AI 概念股探索引擎**。我們旨在運用 Google Gemini AI 的自然語言處理能力，將抽象的投資概念與具體的股票清單無縫對接，徹底解決資訊不對稱的問題，讓所有投資人都能即時、輕鬆地發掘市場新機會。

### 1\.2 核心價值主張

本產品提供兩大核心功能，形成一個雙向的資訊探索迴路：

- **主題到個股 (Theme-to-Stock):** 使用者輸入一個投資概念（如：「AI 伺服器」），AI 能即時生成一份包含主題說明、市場熱度評分，以及最多 10 檔相關個股的清單，並解釋每支股票入選的理由。 

- **個股到主題 (Stock-to-Theme):** 使用者輸入一支股票代號或名稱（如：「2330」），AI 能反向分析並找出該股票所屬的至少 5 個關鍵投資主題，並說明其在各主題中扮演的角色。

### 1\.3 目標使用者

我們將優先服務以下兩類使用者，以驗證核心市場需求：

- **核心目標：半專業散戶 (Kevin)**

   - **市場規模:** 約 45 萬人。 

   - **人物側寫:** 35 歲科技業工程師，投資經驗 8 年。 

   - **痛點與需求:** 追求高效率，需即時掌握市場題材輪動。目前高度依賴手動維護 Excel 表格來追蹤概念股，過程耗時且資訊常落後於市場變化。 

- **潛在轉換：投資新手 (Irene)**

   - **市場規模:** 約 60 萬人 (30 歲以下)。 

   - **人物側寫:** 26 歲自由工作者，投資經驗 1 年。 

   - **痛點與需求:** 對市場術語不熟悉，投資經驗較少，需要一個低門檻、易於學習的工具來探索熱門題材，快速了解市場動態。

## 2\.0 系統架構與技術棧 (System Architecture & Tech Stack)

#### 2\.1 技術棧 (Technology Stack)

- **前端 (Frontend):** **React (Next.js)** 搭配 **Tailwind CSS** 進行開發，並部署於 **Vercel**。這套組合能提供強大的組件化能力、簡化部署流程，並利用 Vercel 的全球 CDN 加速內容傳遞。 [\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#ae265fc3-9b6d-48bc-81b9-f6e80f2300ff,87068a5e-7145-4df4-83be-cfbb615428cd,e39c86c9-17dc-406c-9669-292776c96cc3,0c4a70ee-649a-411e-9bd3-e6ae698fadc1,be030308-e0b2-4235-9e99-b595fa9dcc4b,110ade1e-f88c-43fc-82bf-9da8a92a98c8,ade1ddee-227c-4da8-89ea-250d0d023c46)[\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#eebde9b3-8ed3-4331-84fa-652de3f72bcc)

- **AI 引擎 (AI Engine):** **Google Gemini 1.5-flash** 模型。此模型專為需要快速回應且成本敏感的應用設計，其強大的 JSON 結構化輸出能力是確保資料品質與系統穩定性的關鍵。 [\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#ae265fc3-9b6d-48bc-81b9-f6e80f2300ff,87068a5e-7145-4df4-83be-cfbb615428cd,e39c86c9-17dc-406c-9669-292776c96cc3,0c4a70ee-649a-411e-9bd3-e6ae698fadc1,be030308-e0b2-4235-9e99-b595fa9dcc4b,110ade1e-f88c-43fc-82bf-9da8a92a98c8,ade1ddee-227c-4da8-89ea-250d0d023c46)[\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#72d8ca5c-81e0-4795-b452-9aa83dd214c6,1e06322c-21b7-4124-b871-ae47f9acc08a,d9cfcece-6cbe-401d-acf0-6f261a57d07c,65492499-afd3-4136-808a-9e9b7931e6e2,2caa51e6-401d-4c27-8b87-cd7cec6f9dad,4524c5b2-40a2-45b7-a5de-f384c8d3aa39,996b279f-ecda-4157-bfe3-fec474683e09,ba8587d8-0a1c-4f96-b048-f8d04387692b,7df0592f-c9a4-4353-a897-848154be4ec1,35ed4396-6383-4265-977f-136b49749fa1,0810112d-3802-4f71-bcc6-6f14b25578b7,688b212c-71d1-4bf2-a81a-715188cc79c2,a68a1b27-cebd-40bb-ab33-3fdf0cc358d1,77e6c095-8b15-4ad4-89b8-26d09e4be31d,8c9e9cd5-8f5c-4e72-844e-8a9d993ed3d3,d0f8ead0-d7be-4ab4-bda8-ad11062cd17d,47512012-99c7-41c8-8fff-38ca46d4c512,0945c4aa-2187-4d4c-a5e6-cd0dbba97637,e2054995-3c3c-4d7f-8ca2-a29ee0494f33,4b4a381b-5ea6-428f-83dd-dc663bcf3bbc,52900f93-2119-4e2b-ab9a-bdd16183331c,a0bd4908-49fe-4fda-8e06-8b24ebf7225d,0b1ec697-53f9-433f-90cb-842e35446520,a016059f-2490-4299-a0ff-26d35b0b7880,ba85fb6e-a4f7-417b-ac07-2ccc77bb34b2,6d1f7b2b-507b-467e-81ee-13854d80935f,ef8da62f-c336-43a4-83a0-32f3193c13f2,54430bee-6dc8-4663-936b-b063897cb81c,0ad2d524-3d01-4cab-906d-df91bd19771b)

- **邊緣 API (Edge API):** **Cloudflare Workers**。所有前端請求皆透過此代理，不僅能提供極低延遲，還能安全地管理後端服務的 API 金鑰，其每日 10 萬次的免費請求足以支撐 MVP 階段流量。 [\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#ae265fc3-9b6d-48bc-81b9-f6e80f2300ff,87068a5e-7145-4df4-83be-cfbb615428cd,e39c86c9-17dc-406c-9669-292776c96cc3,0c4a70ee-649a-411e-9bd3-e6ae698fadc1,be030308-e0b2-4235-9e99-b595fa9dcc4b,110ade1e-f88c-43fc-82bf-9da8a92a98c8,ade1ddee-227c-4da8-89ea-250d0d023c46)[\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#b61be7ed-d973-496d-ab47-7bf4a01394a5,b7d8908b-9289-4b28-a9e1-a2efcf50ac69,81f8945e-8f2a-4c35-ade5-27dfa3ef985f,684d94fc-869a-44bc-97b5-f70c7039627f,29a01a37-46df-4e91-bf34-88b86d10fe78)

- **快取與儲存 (Cache & Storage):**

   - **Cloudflare KV:** 用於後端快取，儲存每日由排程生成的熱門主題清單，提供毫秒級的讀取速度，是達成「三秒回應」目標的核心技術。 [\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#ae265fc3-9b6d-48bc-81b9-f6e80f2300ff,87068a5e-7145-4df4-83be-cfbb615428cd,e39c86c9-17dc-406c-9669-292776c96cc3,0c4a70ee-649a-411e-9bd3-e6ae698fadc1,be030308-e0b2-4235-9e99-b595fa9dcc4b,110ade1e-f88c-43fc-82bf-9da8a92a98c8,ade1ddee-227c-4da8-89ea-250d0d023c46)

   - **Browser Local Storage:** 用於前端儲存使用者收藏的主題，實現免登入的個人化追蹤功能。 [\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#ae265fc3-9b6d-48bc-81b9-f6e80f2300ff,87068a5e-7145-4df4-83be-cfbb615428cd,e39c86c9-17dc-406c-9669-292776c96cc3,0c4a70ee-649a-411e-9bd3-e6ae698fadc1,be030308-e0b2-4235-9e99-b595fa9dcc4b,110ade1e-f88c-43fc-82bf-9da8a92a98c8,ade1ddee-227c-4da8-89ea-250d0d023c46)

- **後端數據管道 (Backend Data Pipeline):** **GitHub Actions** 搭配 **Python**。每日定時觸發工作流程，執行 Python 腳本，透過 RAG 技術分析最新資訊源，生成新的概念股清單並寫入 Cloudflare KV。 [\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#ae265fc3-9b6d-48bc-81b9-f6e80f2300ff,87068a5e-7145-4df4-83be-cfbb615428cd,e39c86c9-17dc-406c-9669-292776c96cc3,0c4a70ee-649a-411e-9bd3-e6ae698fadc1,be030308-e0b2-4235-9e99-b595fa9dcc4b,110ade1e-f88c-43fc-82bf-9da8a92a98c8,ade1ddee-227c-4da8-89ea-250d0d023c46)

#### 2\.2 專案架構 (Project Architecture)

專案採用模組化的 **Monorepo** 架構，將不同職責的程式碼分離至獨立目錄，以提高可維護性與擴展性。 [\[5\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#b91e311d-4eed-491a-a2c4-f21679044321,a7697142-6b05-407c-833b-b989bacb83ed,e7e72870-a9b1-4154-b732-96a1bcd42b57,a347db41-c279-4f2e-bce3-670693eeca01,39b67649-5087-4d90-85d3-2a17aa652875)[\[6\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#43df5955-f1ee-4ead-8981-ede53d297c01,b1ab9748-cf6d-46d8-af7f-1b8e74bf9d3b,9b8e3aaf-2e73-4f8f-94d0-3c092c74144e,f0e428b5-a0fb-4c2d-960d-6d702cbec58e,bbd171cb-67b3-4075-8527-79e4e0b75883)

- `data-pipeline/`: 存放所有 Python 相關的 ETL 與 RAG 腳本，負責每日的數據處理與分析。 [\[5\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#b91e311d-4eed-491a-a2c4-f21679044321,a7697142-6b05-407c-833b-b989bacb83ed,e7e72870-a9b1-4154-b732-96a1bcd42b57,a347db41-c279-4f2e-bce3-670693eeca01,39b67649-5087-4d90-85d3-2a17aa652875)[\[6\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#43df5955-f1ee-4ead-8981-ede53d297c01,b1ab9748-cf6d-46d8-af7f-1b8e74bf9d3b,9b8e3aaf-2e73-4f8f-94d0-3c092c74144e,f0e428b5-a0fb-4c2d-960d-6d702cbec58e,bbd171cb-67b3-4075-8527-79e4e0b75883)

- `edge-api/`: 存放 Cloudflare Workers 的 TypeScript 程式碼，作為前端與後端服務 (如 Gemini API) 之間的中介層。 [\[5\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#b91e311d-4eed-491a-a2c4-f21679044321,a7697142-6b05-407c-833b-b989bacb83ed,e7e72870-a9b1-4154-b732-96a1bcd42b57,a347db41-c279-4f2e-bce3-670693eeca01,39b67649-5087-4d90-85d3-2a17aa652875)[\[6\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#43df5955-f1ee-4ead-8981-ede53d297c01,b1ab9748-cf6d-46d8-af7f-1b8e74bf9d3b,9b8e3aaf-2e73-4f8f-94d0-3c092c74144e,f0e428b5-a0fb-4c2d-960d-6d702cbec58e,bbd171cb-67b3-4075-8527-79e4e0b75883)

- `web/`: 存放 Next.js 前端應用程式的所有程式碼，包含 UI 組件、狀態管理與頁面邏輯。 [\[5\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#b91e311d-4eed-491a-a2c4-f21679044321,a7697142-6b05-407c-833b-b989bacb83ed,e7e72870-a9b1-4154-b732-96a1bcd42b57,a347db41-c279-4f2e-bce3-670693eeca01,39b67649-5087-4d90-85d3-2a17aa652875)[\[6\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#43df5955-f1ee-4ead-8981-ede53d297c01,b1ab9748-cf6d-46d8-af7f-1b8e74bf9d3b,9b8e3aaf-2e73-4f8f-94d0-3c092c74144e,f0e428b5-a0fb-4c2d-960d-6d702cbec58e,bbd171cb-67b3-4075-8527-79e4e0b75883)

#### 2\.3 AI 服務層 (geminiService.ts)

此檔案是系統智能的核心，將所有與 Gemini API 的互動都封裝在此服務層中，以便於未來更換模型或增加新的 AI 功能。此層負責精心設計系統提示 (System Prompt) 和嚴格的 JSON Schema，將 AI 的自然語言輸出轉換為可靠的結構化數據。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#72d8ca5c-81e0-4795-b452-9aa83dd214c6,1e06322c-21b7-4124-b871-ae47f9acc08a,d9cfcece-6cbe-401d-acf0-6f261a57d07c,65492499-afd3-4136-808a-9e9b7931e6e2,2caa51e6-401d-4c27-8b87-cd7cec6f9dad,4524c5b2-40a2-45b7-a5de-f384c8d3aa39,996b279f-ecda-4157-bfe3-fec474683e09,ba8587d8-0a1c-4f96-b048-f8d04387692b,7df0592f-c9a4-4353-a897-848154be4ec1,35ed4396-6383-4265-977f-136b49749fa1,0810112d-3802-4f71-bcc6-6f14b25578b7,688b212c-71d1-4bf2-a81a-715188cc79c2,a68a1b27-cebd-40bb-ab33-3fdf0cc358d1,77e6c095-8b15-4ad4-89b8-26d09e4be31d,8c9e9cd5-8f5c-4e72-844e-8a9d993ed3d3,d0f8ead0-d7be-4ab4-bda8-ad11062cd17d,47512012-99c7-41c8-8fff-38ca46d4c512,0945c4aa-2187-4d4c-a5e6-cd0dbba97637,e2054995-3c3c-4d7f-8ca2-a29ee0494f33,4b4a381b-5ea6-428f-83dd-dc663bcf3bbc,52900f93-2119-4e2b-ab9a-bdd16183331c,a0bd4908-49fe-4fda-8e06-8b24ebf7225d,0b1ec697-53f9-433f-90cb-842e35446520,a016059f-2490-4299-a0ff-26d35b0b7880,ba85fb6e-a4f7-417b-ac07-2ccc77bb34b2,6d1f7b2b-507b-467e-81ee-13854d80935f,ef8da62f-c336-43a4-83a0-32f3193c13f2,54430bee-6dc8-4663-936b-b063897cb81c,0ad2d524-3d01-4cab-906d-df91bd19771b)[\[6\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#43df5955-f1ee-4ead-8981-ede53d297c01,b1ab9748-cf6d-46d8-af7f-1b8e74bf9d3b,9b8e3aaf-2e73-4f8f-94d0-3c092c74144e,f0e428b5-a0fb-4c2d-960d-6d702cbec58e,bbd171cb-67b3-4075-8527-79e4e0b75883)

它包含三個核心的異步函數：

- **`fetchStockConcepts(prompt: string)`**

   - **功能:** 處理「主題到個股」的核心搜尋。

   - **系統提示設計:** 精心引導 AI 扮演專精於台股的金融分析師，並**特別強調**必須為每支股票提供正確的交易所（TWSE 或 TPEx），此點被視為任務最關鍵的部分。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#72d8ca5c-81e0-4795-b452-9aa83dd214c6,1e06322c-21b7-4124-b871-ae47f9acc08a,d9cfcece-6cbe-401d-acf0-6f261a57d07c,65492499-afd3-4136-808a-9e9b7931e6e2,2caa51e6-401d-4c27-8b87-cd7cec6f9dad,4524c5b2-40a2-45b7-a5de-f384c8d3aa39,996b279f-ecda-4157-bfe3-fec474683e09,ba8587d8-0a1c-4f96-b048-f8d04387692b,7df0592f-c9a4-4353-a897-848154be4ec1,35ed4396-6383-4265-977f-136b49749fa1,0810112d-3802-4f71-bcc6-6f14b25578b7,688b212c-71d1-4bf2-a81a-715188cc79c2,a68a1b27-cebd-40bb-ab33-3fdf0cc358d1,77e6c095-8b15-4ad4-89b8-26d09e4be31d,8c9e9cd5-8f5c-4e72-844e-8a9d993ed3d3,d0f8ead0-d7be-4ab4-bda8-ad11062cd17d,47512012-99c7-41c8-8fff-38ca46d4c512,0945c4aa-2187-4d4c-a5e6-cd0dbba97637,e2054995-3c3c-4d7f-8ca2-a29ee0494f33,4b4a381b-5ea6-428f-83dd-dc663bcf3bbc,52900f93-2119-4e2b-ab9a-bdd16183331c,a0bd4908-49fe-4fda-8e06-8b24ebf7225d,0b1ec697-53f9-433f-90cb-842e35446520,a016059f-2490-4299-a0ff-26d35b0b7880,ba85fb6e-a4f7-417b-ac07-2ccc77bb34b2,6d1f7b2b-507b-467e-81ee-13854d80935f,ef8da62f-c336-43a4-83a0-32f3193c13f2,54430bee-6dc8-4663-936b-b063897cb81c,0ad2d524-3d01-4cab-906d-df91bd19771b)

- **`fetchConceptsForStock(stockIdentifier: string)`**

   - **功能:** 驅動「個股到主題」的反向查詢功能。

   - **系統提示設計:** 指示 AI 根據股號或名稱，找出至少 5 個相關概念主題，並說明該股在其中的具體角色。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#72d8ca5c-81e0-4795-b452-9aa83dd214c6,1e06322c-21b7-4124-b871-ae47f9acc08a,d9cfcece-6cbe-401d-acf0-6f261a57d07c,65492499-afd3-4136-808a-9e9b7931e6e2,2caa51e6-401d-4c27-8b87-cd7cec6f9dad,4524c5b2-40a2-45b7-a5de-f384c8d3aa39,996b279f-ecda-4157-bfe3-fec474683e09,ba8587d8-0a1c-4f96-b048-f8d04387692b,7df0592f-c9a4-4353-a897-848154be4ec1,35ed4396-6383-4265-977f-136b49749fa1,0810112d-3802-4f71-bcc6-6f14b25578b7,688b212c-71d1-4bf2-a81a-715188cc79c2,a68a1b27-cebd-40bb-ab33-3fdf0cc358d1,77e6c095-8b15-4ad4-89b8-26d09e4be31d,8c9e9cd5-8f5c-4e72-844e-8a9d993ed3d3,d0f8ead0-d7be-4ab4-bda8-ad11062cd17d,47512012-99c7-41c8-8fff-38ca46d4c512,0945c4aa-2187-4d4c-a5e6-cd0dbba97637,e2054995-3c3c-4d7f-8ca2-a29ee0494f33,4b4a381b-5ea6-428f-83dd-dc663bcf3bbc,52900f93-2119-4e2b-ab9a-bdd16183331c,a0bd4908-49fe-4fda-8e06-8b24ebf7225d,0b1ec697-53f9-433f-90cb-842e35446520,a016059f-2490-4299-a0ff-26d35b0b7880,ba85fb6e-a4f7-417b-ac07-2ccc77bb34b2,6d1f7b2b-507b-467e-81ee-13854d80935f,ef8da62f-c336-43a4-83a0-32f3193c13f2,54430bee-6dc8-4663-936b-b063897cb81c,0ad2d524-3d01-4cab-906d-df91bd19771b)

- **`fetchTrendingThemes(sortBy: 'popular' | 'latest')`**

   - **功能:** 獲取側邊欄的趨勢主題，作為使用者探索的起點。

   - **系統提示設計:** 提示是動態的，能根據 `popular`（熱門）或 `latest`（最新）參數，向 AI 請求不同維度的趨勢清單。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#72d8ca5c-81e0-4795-b452-9aa83dd214c6,1e06322c-21b7-4124-b871-ae47f9acc08a,d9cfcece-6cbe-401d-acf0-6f261a57d07c,65492499-afd3-4136-808a-9e9b7931e6e2,2caa51e6-401d-4c27-8b87-cd7cec6f9dad,4524c5b2-40a2-45b7-a5de-f384c8d3aa39,996b279f-ecda-4157-bfe3-fec474683e09,ba8587d8-0a1c-4f96-b048-f8d04387692b,7df0592f-c9a4-4353-a897-848154be4ec1,35ed4396-6383-4265-977f-136b49749fa1,0810112d-3802-4f71-bcc6-6f14b25578b7,688b212c-71d1-4bf2-a81a-715188cc79c2,a68a1b27-cebd-40bb-ab33-3fdf0cc358d1,77e6c095-8b15-4ad4-89b8-26d09e4be31d,8c9e9cd5-8f5c-4e72-844e-8a9d993ed3d3,d0f8ead0-d7be-4ab4-bda8-ad11062cd17d,47512012-99c7-41c8-8fff-38ca46d4c512,0945c4aa-2187-4d4c-a5e6-cd0dbba97637,e2054995-3c3c-4d7f-8ca2-a29ee0494f33,4b4a381b-5ea6-428f-83dd-dc663bcf3bbc,52900f93-2119-4e2b-ab9a-bdd16183331c,a0bd4908-49fe-4fda-8e06-8b24ebf7225d,0b1ec697-53f9-433f-90cb-842e35446520,a016059f-2490-4299-a0ff-26d35b0b7880,ba85fb6e-a4f7-417b-ac07-2ccc77bb34b2,6d1f7b2b-507b-467e-81ee-13854d80935f,ef8da62f-c336-43a4-83a0-32f3193c13f2,54430bee-6dc8-4663-936b-b063897cb81c,0ad2d524-3d01-4cab-906d-df91bd19771b)

#### 2\.4 技術介面與錯誤碼

**端點定義（MVP）**

| 方法 | 路徑 | 查詢參數 | 回傳 | 約束 | 
|---|---|---|---|---|
| GET | /trending | – | `StockConcept[]` | 長度=**15**；`heatScore` 0–100 | 
| GET | /search | `mode=theme`、`q=關鍵詞` | `StockConcept` | `stocks` **≤10** | 
| GET | /search | `mode=stock`、`q=Ticker` | `StockAnalysisResult` | `themes` **≥5** | 

**錯誤碼與前端行為**

| 狀態碼 | code | 說明 | 前端行為 | 
|---|---|---|---|
| 400 | invalid_mode | mode 僅允許 theme/stock | **Empty** | 
| 404 | no_results | 查無資料 | **Empty** | 
| 429 | rate_limited | 請求過多 | **Retry** | 
| 500 | internal_error | 服務異常 | **Retry** | 

**錯誤回應 JSON**

```json
{ "code": "no_results", "message": "No data found", "trace_id": "xyz789" }
```

## 3\.0 核心功能詳述 (Detailed Functional Breakdown)

### 3\.1 AI 雙向搜尋引擎 (Must-have)

#### 3\.1.1 雙模式搜尋框

此元件是使用者與 AI 引擎互動最主要的入口，其設計旨在透過單一、直覺的介面服務兩種截然不同的核心使用情境。[\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

- **使用者介面 (UI):**

   - 在頁面最顯眼的位置提供一個統一的搜尋輸入框。[\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

   - 搜尋框旁設有模式切換器（例如：Toggle Buttons），讓使用者可以明確地在「主題 (Theme)」和「個股 (Stock)」兩種模式之間進行選擇。[\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

- **互動邏輯 (Interaction Logic):**

   - **動態引導文字:** 搜尋框內的佔位文字 (placeholder text) 會根據當前選擇的模式動態變更。[\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

      - 在「主題」模式下，會顯示：「搜尋主題，如：光通訊」。[\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

      - 在「個股」模式下，會顯示：「輸入股號/名稱，如：2330 或 台積電」。[\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

   - **狀態反饋:** 當使用者提交查詢且系統正在處理 AI 請求時，搜尋按鈕會進入禁用 (disabled) 狀態，並顯示載入指示器 (loading spinner)，以提供明確的視覺反饋。[\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#326a594d-d05b-400b-b0d7-8d00791d25d0,b997d2a6-3235-40ec-8519-d1d68ccf01ba,28a582ac-89a1-40dd-927d-7e27e0acfd4f,7b1bcaa4-d9d5-4e55-91bd-ba3263c873d6,f121004b-4ed3-4900-85df-9cd46f2d1312,747ab8ee-96dc-4fcb-b137-231d0445a903,fee19ba9-f74f-4b32-89d3-bcd635720a8a,dcd4a81a-90e5-4843-b5ad-d1bb2bf98e00,55f44ade-146e-4c2b-bebe-f5ace5122116,d0dbbea3-cc4b-4627-9be5-b94f491b071d,e120ae89-2e55-49b4-b7ee-5ec5801227f4,6cf1cd15-b189-4cd9-8928-1863ae2eb508,b29cd103-cb7b-46a1-9983-e6872fb59968,3e770351-cdc7-469f-91c0-3e9fa8b32a6d,876842f1-5820-4bf4-b892-c4920304ce1e,470cfa12-8ff9-4911-8682-d38d086121e5,37438af3-2df9-49e7-8e88-3f0fc92bd549,dc3f23e6-2cdd-4e5e-b05e-bbce9fd491bf,52ffa19d-bf74-4b07-907e-4b43a8d41b08,89f5f9ee-ffb2-422b-a901-c0aff13cd88f,7e21ec53-167a-4ab3-b07c-531d9996a0bf,48949cd6-17cd-4921-9a77-714e7915c7a1,8ed11583-6348-44a8-a6a0-cde41feb9b91,9f54b3ba-5927-41d9-ba48-ccb5a453d015,cc2a7b45-bad1-42e5-9f35-99c68daf527b,4bb72a67-762f-43d0-a0c9-8e77a6f5b070,e6879017-2252-4f79-8349-37c59b9828a7,3eb968a9-4968-4d97-810d-86c2e42e4928,4d4726f1-f6c6-4c69-8634-31bef57eb61f,a4e016d0-69c2-44b6-86e0-f878fbd951c1,38fcab02-79b7-4ff5-ab46-d27b2e2ff1d1,3e8df5d6-8af2-41f5-bf6d-273da0bf29f3)

- **關聯元件:**

   - **SearchBar.tsx:** 此 React 元件負責管理搜尋框自身的狀態，包括使用者輸入的查詢字串和當前的搜尋模式（'theme' 或 'stock'）。當使用者提交表單時，它會呼叫由上層元件 (App.tsx) 傳入的 `onSearch` 回呼函式。

#### 3\.1.2 主題到個股分析 (Theme-to-Stock)

- **使用者動作**：在「主題」模式下，於搜尋框輸入一個投資概念（例如：「光通訊」）並提交查詢。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

- **後端邏輯 (AI 互動)**：

   - 應用程式會將使用者的查詢字串傳送至 Gemini API。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

   - 一個詳細的系統提示 (System Prompt) 會被用來引導 AI 扮演一位專精於台股市場的金融分析師。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

   - 提示中明確要求 AI 必須回傳一份結構化的 JSON 資料，其中需包含：

      1. **主題說明**：對該主題的簡潔解釋。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)[\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#f3da2ae2-8143-4fd4-bc48-56460c7e1deb,a7cfb415-9e08-4e7c-ad77-77d54e3815f3,462fada0-1530-4948-9f5a-be7f2508c6e9,d7ce78d2-51ea-4562-b1d6-9fa604e17d70,fd31d879-b6ee-4fae-85c6-2f2fa40bc77b)

      2. **市場熱度分數**：一個介於 0-100 之間的分數，評估市場當前的關注度。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)[\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#f3da2ae2-8143-4fd4-bc48-56460c7e1deb,a7cfb415-9e08-4e7c-ad77-77d54e3815f3,462fada0-1530-4948-9f5a-be7f2508c6e9,d7ce78d2-51ea-4562-b1d6-9fa604e17d70,fd31d879-b6ee-4fae-85c6-2f2fa40bc77b)

      3. **個股列表**：最多 10 檔相關的股票清單。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)[\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#f3da2ae2-8143-4fd4-bc48-56460c7e1deb,a7cfb415-9e08-4e7c-ad77-77d54e3815f3,462fada0-1530-4948-9f5a-be7f2508c6e9,d7ce78d2-51ea-4562-b1d6-9fa604e17d70,fd31d879-b6ee-4fae-85c6-2f2fa40bc77b)

   - **關鍵指令**：為了確保資料品質，提示中特別強調 AI 必須為每支股票提供正確的交易所歸屬（TWSE 或 TPEx），並附上一至兩句的簡潔說明，解釋該股票為何與此主題相關。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

   - 為確保資料完整性與可預測性，請求中會包含一個嚴格的 JSON Schema，強制 AI 的輸出格式必須符合系統要求，這一步是將 AI 的自然語言輸出轉換為可靠、可用的結構化數據的關鍵。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

- **前端邏輯 (顯示)**：

   - 從 AI 收到的結構化資料會在中間的主內容區，使用 `ThemeCard` 組件進行渲染。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)[\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6ddc38f3-74fc-48af-a5de-0c782ab7c3da,6b1445a5-cf9f-4b53-a98b-260446ce8347,bd7844fc-84b6-45e3-9ac6-421ce7150849,65f6f79f-2656-43db-a75e-67c3edff6918,fd67fa0e-1b7b-4c3e-9e00-785ace9865d1,19e4e148-c724-4f9c-a4bb-bd5bf14be5dc,dc00308a-d223-48f5-b741-a6f36b172323,c2620c5b-3e66-48f3-8ab9-3cf055204878,f6791ad4-1cf9-4267-abce-4268a3ff7ad7,bee553a0-84d7-48a8-81a3-bf1239f086be,44f588a9-fa77-4338-a221-3d4bcd50e0e6,2a41992a-0918-4831-b4f7-31ea444b2b15,6b177fa9-e821-4a3d-9124-6779f17093c5,2daeaae5-3f06-4b3e-be24-60dec0949845,f0f5b5e6-5282-48d6-9675-db727b8ab08c,3ddd06e7-0969-42bd-abeb-336ae5c8f966,acab642c-ef4e-49c3-89fb-73550f6c7aad,182ca6b4-a83c-44d6-9dac-22be49ac9c92,11e14646-44e3-4ed0-9196-7ef991f6bdb6,0fd06202-425a-4dda-8c12-4bb4bc2d7282,98cfdbe6-f77d-4464-a6f6-3d78cf3bf617,ebb0b823-9f6d-40ef-9b89-0927d0fb1aba,b9731386-66b6-4470-88f2-b57af9f12f04)

   - 若 AI 針對一個較廣泛的查詢回傳了多個相關主題，系統會將這些主題以可切換的分頁標籤 (tabs) 形式呈現，讓使用者可以選擇最符合其預期的結果。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

#### 3\.1.3 個股到主題分析 (Stock-to-Theme)

- **使用者動作**：在「個股」模式下輸入股票代號或名稱（例如：「2330」），並提交查詢。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

- **後端邏輯 (AI 互動)**：

   1. 前端將使用者輸入的股票識別碼（股號或名稱）傳送至 Gemini API。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

   2. 系統會使用一套專為此功能設計的系統提示 (System Prompt)，指示 AI 識別該股票，並找出其所屬的**至少 5 個**關鍵概念主題。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)[\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#dc38ea7b-67c5-4e1c-8d2c-715a55cb15f3,5961be08-b121-4b4f-995c-acab534fca7d,b498b79a-a97a-461b-a4c1-b6005f17e4bb,09969677-9b7b-4a3a-9d36-1550cbe27779)[\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#f3da2ae2-8143-4fd4-bc48-56460c7e1deb,a7cfb415-9e08-4e7c-ad77-77d54e3815f3,462fada0-1530-4948-9f5a-be7f2508c6e9,d7ce78d2-51ea-4562-b1d6-9fa604e17d70,fd31d879-b6ee-4fae-85c6-2f2fa40bc77b)

   3. 對於每個找出的主題，AI 必須提供對應的熱度分數，並詳細說明**該股票在該主題中所扮演的具體角色**。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)[\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#dc38ea7b-67c5-4e1c-8d2c-715a55cb15f3,5961be08-b121-4b4f-995c-acab534fca7d,b498b79a-a97a-461b-a4c1-b6005f17e4bb,09969677-9b7b-4a3a-9d36-1550cbe27779)

   4. 此互動同樣會使用一個特定的 JSON Schema 來規範回應的格式，確保回傳資料的穩定與一致性。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)

- **前端邏輯 (顯示)**：

   1. 分析結果將由一個專門的 `StockAnalysisView` 組件來呈現，清晰地列出該股票所屬的所有概念主題。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6828faf4-21ab-42a7-af76-22d0d522e991,bc7a1308-af33-4b74-b225-c25c36da85fc,62dbc1cc-a224-43b0-9e93-da0ecdd1d288,ee2cbcb6-7a44-4dde-b3a9-14f254870f48,a1a6ef5e-7d4b-409d-b6cc-190afa0a2788,d9c62d34-4009-4361-8088-bcba171c4c80,d7e4781f-32d8-4673-8a85-b78a021a2319,1e2f2159-7f95-49e2-80a9-d44b20ba4201,e9a96fd5-ec09-42e5-af82-93f535dfdeb3,b2c38850-4cfb-4edb-af5c-3c1658dd69f5,026aed4e-275e-4c1f-afe1-f024c7056669,c2e446d6-4ef9-48c0-b5d7-45694f6ebf64,d6b2d5ad-2aff-43d8-9e2c-bf7262ccb57b,07b2cb9e-14a5-42f4-a106-cf0274f9274d,8569cdda-6de0-4d0a-b23f-cd8202ddcb4a,f29ddabf-1efd-49a3-b05d-06a11c81811c,986bc683-a9ce-4c60-b012-ae7b57bdc4d3,72f818b2-625d-4a2b-b188-eaa4271c8348,b02aaa82-240a-4c06-8a5a-75a3fd8191dc,90e9ea88-8296-4b13-a766-03aaecbea226,aa82ea3e-e45d-442e-9c3e-bf4692093cd8,d57e958b-1427-4afe-997f-8ac3bf7c0c9a,54145e03-c21e-45c4-b6ab-43069d34bf0f,56724541-9ee4-446f-9dfc-1fd6e862c36f,310f124f-a5a7-4ed3-89d4-d8034c1b003e)[\[5\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/19945860-b8f9-48f9-978a-76d5cab11e87#6ddc38f3-74fc-48af-a5de-0c782ab7c3da,6b1445a5-cf9f-4b53-a98b-260446ce8347,bd7844fc-84b6-45e3-9ac6-421ce7150849,65f6f79f-2656-43db-a75e-67c3edff6918,fd67fa0e-1b7b-4c3e-9e00-785ace9865d1,19e4e148-c724-4f9c-a4bb-bd5bf14be5dc,dc00308a-d223-48f5-b741-a6f36b172323,c2620c5b-3e66-48f3-8ab9-3cf055204878,f6791ad4-1cf9-4267-abce-4268a3ff7ad7,bee553a0-84d7-48a8-81a3-bf1239f086be,44f588a9-fa77-4338-a221-3d4bcd50e0e6,2a41992a-0918-4831-b4f7-31ea444b2b15,6b177fa9-e821-4a3d-9124-6779f17093c5,2daeaae5-3f06-4b3e-be24-60dec0949845,f0f5b5e6-5282-48d6-9675-db727b8ab08c,3ddd06e7-0969-42bd-abeb-336ae5c8f966,acab642c-ef4e-49c3-89fb-73550f6c7aad,182ca6b4-a83c-44d6-9dac-22be49ac9c92,11e14646-44e3-4ed0-9196-7ef991f6bdb6,0fd06202-425a-4dda-8c12-4bb4bc2d7282,98cfdbe6-f77d-4464-a6f6-3d78cf3bf617,ebb0b823-9f6d-40ef-9b89-0927d0fb1aba,b9731386-66b6-4470-88f2-b57af9f12f04)

   2. 列表中的每一個主題都是可點擊的。點擊後，右側的詳情面板 (`DetailPanel`) 會滑入，載入並顯示該主題的完整資訊（包含主題說明、熱度、以及完整的相關個股列表），讓使用者可以進行更深入的探索。

#### 3\.1.4 市場熱度指標 (Market Heat Indicator)

- **使用者介面 (UI)**

   - 在主題卡片與個股列表中，於標題右側顯示「熱度條 (Heat Bar)」。

   - 熱度條呈現方式：

      - **分數範圍**：0–100

      - **顏色漸層**：由冷色（藍/青）逐漸過渡到暖色（黃/紅）

      - **條狀動畫**：分數更新時平滑變化，避免突兀切換

   - 提供 tooltip，滑鼠懸停時顯示「熱度計算來源說明」。

- **互動邏輯 (Interaction Logic)**

   - 當使用者搜尋主題或個股時，系統會自動回傳熱度分數並顯示於熱度條。

   - 若資料正在載入，熱度條會顯示「閃動中的 placeholder」狀態，直到數據完成更新。

   - 熱度條可作為排序依據，允許使用者在清單中切換「依熱度排序」。

- **後端邏輯 (AI 動作)**

   - 系統每日透過 RAG 流程蒐集資料來源（新聞、財報、社群）。

   - Gemini AI 根據下列維度計算熱度分數：

      1. 新聞提及頻率

      2. 社群討論熱度

      3. 近期股價波動度

   - 模型輸出加權平均分數（0–100），並回傳前端。

- **錨點元件 (Frontend)**

   - `HeatBar.tsx`：

      - 接收 API 回傳的分數

      - 根據分數渲染顏色、長度與動畫效果

      - 提供 tooltip 顯示計算依據

#### 3\.1.5 概念強度排名 (Concept Strength Ranking)

- **使用者介面 (UI)**

   - 在主題卡片的標題區塊，新增「概念強度分數」(0–100)。

   - 強度分數以數字 + 視覺化圖形（圓環圖或條狀圖）呈現。

   - 使用者可在左側邊欄切換「依強度排序」，即時重新排列主題清單。

   - 提供 tooltip，顯示「強度計算依據」的簡要說明（例如：市值佔比、新聞討論度）。

- **互動邏輯 (Interaction Logic)**

   - 預設顯示「熱門」排序；當使用者切換至「依強度排序」時，系統會即時請求後端 API。

   - 載入數據時，強度分數區塊顯示 loading spinner。

   - 點擊主題卡片時，詳情面板中會顯示完整的強度分析，含三大維度：

      1. 市值佔比

      2. 漲幅貢獻度

      3. 新聞/社群討論度

- **後端邏輯 (AI 動作)**

   - 後端每日透過 RAG 層蒐集並更新市場資料：

      - **財務數據**（市值、股價漲跌幅）

      - **市場數據**（成交量變化）

      - **輿情數據**（新聞、社群討論次數）

   - Gemini AI 將三大維度加權整合，輸出「概念強度分數」(0–100)。

   - API 同時回傳「分數明細」與「總分」。

- **錨點元件 (Frontend)**

   - `ConceptStrength.tsx`：

      - 接收 API 回傳的分數與分解數據

      - 渲染圓環圖 / 條狀圖

      - 提供排序切換功能

#### 3\.1.6 個股歸因分析 (Stock Attribution Analysis)

- **使用者介面 (UI)**

   - 在右側「個股詳情面板」新增「入選原因」區塊。

   - 每檔個股呈現以下資訊：

      1. 關聯的主題名稱。

      2. 入選依據（來源類型：新聞、財報、公告）。

      3. 更新時間戳。

      4. 原始來源連結（點擊後於新視窗開啟）。

   - 當無資料時，顯示「暫無歸因資訊」

- **互動邏輯 (Interaction Logic)**

   - 當使用者點擊中間面板的個股時，右側詳情面板即時載入該股的入選原因。

   - 若歸因資料正在更新，顯示骨架屏 (skeleton)；若抓取失敗，顯示錯誤提示與「重試」按鈕。

   - 使用者可點擊來源連結，查看新聞或財報原文。

   - 資料更新時以漸進動畫替換，避免跳動。

- **後端邏輯 (AI 動作)**

   - Gemini AI 在 RAG 流程中會同時保存「來源追溯」資訊：

      - **來源**：新聞標題與連結、財報段落、公司公告摘要

      - **AI 判斷理由**：以自然語言生成的簡短說明（例：「該公司為 CoWoS 核心供應商，相關新聞報導顯示其產能滿載」）

   - API 會輸出一個結構化 JSON，包含：

      - 股票代號與名稱

      - 主題名稱清單

      - 每個主題的入選依據與來源 URL

- **錨點元件 (Frontend)**

   - `StockAttribution.tsx`：渲染入選原因列表。

   - 與 `StockDetailPanel.tsx` 整合，負責載入與展示歸因資料。

   - 使用通用狀態元件：`LoadingSkeleton.tsx`、`ErrorState.tsx`、`EmptyState.tsx`。

### 3\.2 介面佈局與核心元件 (Must-have)

#### 3\.2.1 三欄式佈局

**版面結構（Layout）：**

- **左欄 Sidebar**：趨勢主題清單＋我的收藏。固定寬度，支援排序／篩選控制列。

- **中欄 Detail（主題分析面板）**：顯示單一主題的關鍵資訊（熱度、強度、代表性個股、情緒、最新依據）。

- **右欄 Stock（個股詳情面板）**：承載個股摘要與「個股歸因分析」。可開合。

**區塊內容（Per Column）：**

- **左欄**：

   - 清單卡片：主題名稱、熱度條、（可選）情緒條、代表性個股概覽（最多3檔）。

   - 控制列：排序（Popular / Latest / Heat / Strength / ΔSentiment）與篩選（收藏、異常、轉正、轉負）。

- **中欄**：

   - 標題＋一句話描述、熱度條、概念強度（3維度簡述）、代表性個股（Top 5，點即開右欄）、情緒走勢（7/30天）、最新三則依據（新聞／公告連結）。

- **右欄**：

   - 個股標題與主題標籤、近況概覽、入選原因（來源標籤＋一句話理由＋時間＋連結）、延伸連結（如有）。

**互動與切換（Interaction）：**

- 點擊左欄主題 → 中欄載入該主題分析；保持左欄滾動位置。

- 在中欄點代表性個股 → 右欄開啟個股詳情（歸因 Lazy Load）。

- 在右欄點主題標籤 → 中欄切換至該主題；右欄保持開啟並更新所屬標記。

- 重複點擊相同項目不重抓資料；狀態以最後一次操作為準。

**狀態呈現（Loading / Error / Empty）：**

- 三欄各自管理 Skeleton／Error／Empty，不互相覆蓋。

- API 失敗顯示錯誤與「重試」；成功後以漸進渲染替換。

- 無資料時顯示空狀態與建議動作（如清除篩選）。

**回應式行為（Breakpoints，摘要）：**

- Desktop（三欄齊開）；窄桌機／大平板（左＋中，右欄為抽屜）；平板／手機（單欄分步：左→中→右，提供返回）。

- 抽屜開啟鎖定背景滾動；ESC 或遮罩關閉。

**錨點元件（Frontend）：**

- `Sidebar.tsx`（左欄清單與控制列）

- `DetailPanel.tsx`（中欄主題分析）

- `StockDetailPanel.tsx`（右欄個股詳情，含歸因）

- 共用：`LoadingSkeleton.tsx`、`ErrorState.tsx`、`EmptyState.tsx`

#### 3\.2.2 市場熱度指標 (Heat Bar)

**定位（Where）**

- 用於：左欄主題清單卡片、中欄主題面板標題區、（可選）右欄個股摘要。

- 作用：以統一視覺呈現市場關注度，支援依熱度排序。

**內容與樣式（What）**

- 分數範圍：0–100（整數）；必顯示數值（避免僅依顏色辨識）。

- 視覺：水平條狀；冷→暖的線性漸層（藍/青→黃/橙/紅）。

- 尺寸：

   - List 模式（小）：高度 6–8px，含數值標籤。

   - Detail 模式（中）：高度 10–12px，數值置右對齊。

- Tooltip：顯示計算依據摘要（例：新聞/社群/波動 3 維度占比）與更新時間。

**互動（How）**

- 初次渲染：隨清單/面板資料一起回傳並顯示。

- 依熱度排序：切換後清單即時重排；保持當前選取項（若仍存在）。

- 資料更新：以平滑寬度過渡動畫（200–300ms），避免跳動。

- 無資料：顯示「—」與淡灰條，Tooltip 說明「暫無熱度資料」。

**狀態（Loading / Error / Empty）**

- Loading：灰階骨架條（與最終尺寸一致）。

- Error：以文字提示並保留上次有效值（若有）。

- Empty：不渲染彩色漸層，僅顯示占位條與說明。

**可近用（A11y）**

- `aria-valuemin/now/max` 標註；數值文字永遠可見。

- 對比度符合 AA；在高對比模式下以實色替代漸層。

**關聯元件（Frontend）**

- `HeatBar.tsx`（核心元件；接受 `score`、`size: 'list'|'detail'`、`updatedAt`、`breakdown`）。

- 整合點：`ThemeCard.tsx`、`DetailPanel.tsx`、（可選）`StockHeader.tsx`。

#### 3\.2.3 趨勢主題清單（Trending Themes）

**定位（Where）**

- 左欄固定區塊，作為探索入口；支援與「我的收藏」並列顯示。

- 首屏自動載入；提供熱門/最新兩種排序。

**內容與樣式（What）**

- 每筆卡片：主題名稱、簡短描述（單行截斷）、熱度指標（Heat Bar）、代表性個股 1–3 檔（名稱＋代號，逗號分隔）。

- 清單長度：預設顯示前 15 筆，可滾動。

- 排序切換器：`Popular | Latest`（單選 Toggle，置頂控制列）。

**互動（How）**

- 首次載入自動請求清單；切換 Popular/Latest 立即重排，不重置滾動位置。

- 點擊卡片 → 中欄載入該主題分析；保持左欄滾動位置。

- 代表性個股可點選（可選）：直接在右欄開啟個股詳情。

- 與「排序與篩選」（3.2.7）相容：當套用全域篩選（如只看異常、情緒轉正）時，即時收斂結果。

**狀態（Loading / Error / Empty）**

- Loading：骨架清單（15 條，含熱度占位條與兩行文本占位）。

- Error：顯示錯誤區塊與「重試」按鈕；不覆寫其他欄位內容。

- Empty：顯示「暫無資料」，並提供「清除篩選」捷徑（若有篩選生效）。

**可近用（A11y）**

- 卡片整行可聚焦；Enter 開啟主題；上下鍵瀏覽。

- 熱度分數文字常駐；卡片有 `aria-label="主題：{name}，熱度 {score}"`。

**關聯元件（Frontend）**

- `TrendingThemes.tsx`（資料載入／排序切換／渲染）。

- `ThemeCard.tsx`（卡片樣式與點擊邏輯）。

- 依賴：`HeatBar.tsx`（熱度）、（可選）`StockPills.tsx`（代表性個股列）。

#### 3\.2.4 主內容區: 主題分析面板(Detail Panel)

**定位（Where）**

- 三欄式佈局的中欄，承接左側清單的點擊結果。

- 作為使用者判斷與深入瀏覽的主要視窗。

**內容與樣式（What）**

- 區塊組成：

   1. 主題標題與一句話摘要。

   2. 市場熱度指標（Heat Bar）。

   3. 概念強度分數（含三維度簡述：市值佔比／漲幅貢獻／討論度）。

   4. 代表性個股（Top 5，含名稱、代號與一句話理由）。

   5. 情緒／輿情：近 7/30 天走勢小圖與來源比例。

   6. 最新依據：新聞／公告列表（最多三則，標題＋來源＋時間＋外部連結）。

- 滾動區：支援內部垂直滾動，保留頂部標題區固定。

**互動（How）**

- 左欄點擊主題卡片 → 載入該主題完整資訊。

- 代表性個股 → 點擊後於右欄開啟個股詳情。

- 情緒區塊 → 支援切換 7 天／30 天；Lazy Load 載入時間序列。

- 最新依據 → 點擊標題在新分頁開啟原文。

**狀態（Loading / Error / Empty）**

- Loading：主題標題區先顯示；其餘以骨架占位（條狀、卡片、圖表）。

- Error：顯示錯誤提示與「重試」按鈕；保留上次有效內容（若有）。

- Empty：若缺某一區塊資料，僅隱藏該區塊，其他區塊正常渲染。

**可近用（A11y）**

- 標題、熱度、強度、情緒皆有文字描述；非文字元素提供 aria-label。

- 鍵盤可逐區塊導覽，Enter 開啟右欄或外部連結。

**關聯元件（Frontend）**

- `DetailPanel.tsx`（主容器，控制資料載入與版面）。

- 子元件：

   - `HeatBar.tsx`（市場熱度）

   - `ConceptStrength.tsx`（概念強度）

   - `TopStocks.tsx`（代表性個股）

   - `SentimentSpark.tsx`（情緒走勢）

   - `EvidenceList.tsx`（最新依據）

- 狀態元件：`LoadingSkeleton.tsx`、`ErrorState.tsx`、`EmptyState.tsx`

#### 3\.2.5 右側：個股詳情面板（Stock Detail Panel）

**定位（Where）**

- 三欄式佈局的右欄，承接中欄主題分析面板中「代表性個股」的點擊行為。

- 作為使用者檢視單一股票細節與入選原因的窗口。

**內容與樣式（What）**

- 區塊組成：

   1. 個股標題（名稱＋代號）與一行摘要。

   2. 所屬主題標籤（最多 5 個，點擊可切換至對應主題）。

   3. 基本概覽：近期漲跌幅、成交量變化等精簡數據。

   4. 入選原因（個股歸因分析）：來源標籤（新聞／財報／公告）、一句話理由、時間戳、外部連結（最多 3 則）。

   5. 快速連結（若有）：新聞／公告／法說會簡報等外部來源。

- 視覺：採卡片式分段，標籤具色彩區分來源。

**互動（How）**

- 中欄點擊個股 → 右欄即時展開詳情。

- 點擊主題標籤 → 中欄切換至該主題分析；右欄保留當前個股並更新標籤。

- 入選原因 → 點擊外部連結在新分頁開啟。

- 返回控制 → 右上角「關閉」或 ESC 鍵關閉詳情面板。

- 重複點擊同一個股 → 不重複請求資料，直接顯示快取內容。

**狀態（Loading / Error / Empty）**

- Loading：骨架屏（標題＋摘要＋卡片占位）。

- Error：錯誤提示與「重試」按鈕；若有舊快照則保留顯示。

- Empty：若無入選原因，顯示「暫無歸因資訊」。

**可近用（A11y）**

- 標題／主題標籤／入選原因均提供文字與 aria-label。

- 可鍵盤操作逐項展開與關閉。

**關聯元件（Frontend）**

- `StockDetailPanel.tsx`（右欄主容器）。

- 子元件：

   - `StockHeader.tsx`（標題與標籤）

   - `StockOverview.tsx`（基本概覽）

   - `StockAttribution.tsx`（入選原因）

   - `ExternalLinks.tsx`（外部連結）

- 狀態元件：`LoadingSkeleton.tsx`、`ErrorState.tsx`、`EmptyState.tsx`

#### 3\.2.6 清單 ↔ 面板狀態同步規則( List ↔ Detail ↔ Stock）

**定位（Where）**

- 適用於三欄式佈局中，左欄（清單）、中欄（主題分析面板）、右欄（個股詳情面板）的互動關係。

- 確保三欄操作的一致性與可預期性。

**內容與樣式（What）**

- 單一選取原則：同一時間每欄僅保留一個選取對象。

- 狀態傳遞：

   - 左欄選主題 → 中欄更新主題分析。

   - 中欄點個股 → 右欄展開個股詳情。

   - 右欄點主題標籤 → 中欄切換至該主題；右欄保持開啟並同步更新所屬主題。

- 滾動記憶：各欄獨立保留滾動位置與展開狀態，返回時不跳動。

- 重複點擊：相同項目不重複請求，直接顯示已載入內容。

**互動（How）**

- 切換主題時：若右欄個股屬於新主題 → 保留；否則關閉右欄。

- 篩選或排序變更：

   - 若選取項仍存在 → 保留；並滾動錨定到該項。

   - 若被篩除 → 清除選取，顯示提示「結果已更新」，並關閉右欄。

- 返回與關閉：

   - ESC 或「關閉」按鈕 → 僅關閉右欄。

   - 中欄「返回」 → 回到最近一次主題選取並恢復滾動。

**狀態（Loading / Error / Empty）**

- 各欄獨立處理 Skeleton／Error／Empty，不覆寫其他欄。

- 請求中止：快速連續點擊時，中止前一次請求，保留最後一次操作結果。

**可近用（A11y）**

- 焦點切換依左→中→右順序；返回操作後焦點回到觸發元件。

- 當前選取項以高對比框線與 aria-selected 標示。

**關聯元件（Frontend）**

- `Sidebar.tsx`（左欄清單）

- `DetailPanel.tsx`（中欄主題分析）

- `StockDetailPanel.tsx`（右欄個股詳情）

- 共用狀態元件：`LoadingSkeleton.tsx`、`ErrorState.tsx`、`EmptyState.tsx`

**路由與狀態還原**

- 支援以 URL 參數開頁並**還原狀態**：`?mode=theme|stock&q=關鍵詞`。

- 返回上一層時，保留左/中欄**滾動位置**與**展開狀態**。

- 重新整理時：若存在 `mode/q` 參數則依參數還原；否則載入預設 **Trending Top 15**。

#### 3\.2.7 排序與篩選規則（Sort & Filter Rules）

**定位（Where）**

- 適用於左欄主題清單（Trending / 收藏）與中欄主題列表展示區塊。

- 提供統一的排序與篩選控制，讓使用者快速收斂結果。

**內容與樣式（What）**

- **排序選項（單選）**：

   1. 熱門 (Popular) – 預設

   2. 最新 (Latest)

   3. 熱度 (Heat)

   4. 概念強度 (Strength)

   5. 情緒變化 (ΔSentiment)

- **篩選條件（可複選）**：

   - 我的收藏

   - 僅看異常（漲跌幅或成交量異常）

   - 僅看情緒轉正

   - 僅看情緒轉負

- 已啟用的篩選以 Chip 顯示，並可一鍵清除。

**互動（How）**

- 更換排序 → 清單即時重排；若當前選取項仍存在則保持錨定。

- 開啟或關閉篩選 → 清單即時更新；若當前選取項被排除 → 清除選取並關閉右欄。

- 清除篩選 → 還原至原始結果，並滾動回頂部。

- 使用者上次的排序與篩選偏好會保存至 Local Storage，下次進入時沿用。

**狀態（Loading / Error / Empty）**

- Loading：篩選或排序切換後，先顯示骨架清單再替換。

- Error：顯示錯誤提示與「重試」；清單維持上一次有效結果。

- Empty：若無符合結果 → 顯示「無符合條件」與「清除篩選」快捷。

**可近用（A11y）**

- 排序下拉與篩選 Chip 具備 `aria-label` 與 `aria-selected` 標示。

- 鍵盤可用 Tab 瀏覽並以 Enter/Space 切換。

**關聯元件（Frontend）**

- `SortDropdown.tsx`（排序控制）

- `FilterChips.tsx`（篩選條件 Chip 群組）

- `ActiveFiltersBar.tsx`（已啟用篩選顯示與清除全部）

- 整合點：`Sidebar.tsx`、`DetailPanel.tsx`

#### 3\.2.8 響應式佈局與斷點（Responsive Layout & Breakpoints）

**定位（Where）**

- 適用於整體三欄式介面（Sidebar / Detail / Stock），在不同裝置寬度下調整顯示方式。

- 確保 Desktop、Tablet、Mobile 各環境皆能流暢操作。

**內容與樣式（What）**

- **Desktop（≥1280px）**：三欄齊開；右欄可關閉以擴大中欄。

- **Narrow Desktop / Large Tablet（1024–1279px）**：預設雙欄（左＋中）；右欄改為抽屜覆蓋。

- **Tablet（768–1023px）**：單欄主內容；左欄透過抽屜呼出，右欄以全寬抽屜顯示。

- **Mobile（<768px）**：單欄分步（左→中→右）；以底部導覽／返回控制切換。

- **骨架版型**：每個斷點都有對應的 Loading Skeleton，避免切換閃爍。

**互動（How）**

- 視窗縮小：自動將右欄或左欄收合為抽屜，保留選取狀態。

- 視窗放大：自動恢復三欄顯示，並保留滾動位置。

- Mobile 模式：

   - 左欄（清單）為第一步；點主題進入中欄；點個股進入右欄。

   - 系統返回鍵或左上角返回箭頭，逐步回到上一層。

- 抽屜行為：開啟時鎖定背景滾動，ESC 或點擊遮罩關閉。

**狀態（Loading / Error / Empty）**

- Skeleton：依照當前斷點顯示對應版型（單欄／雙欄／三欄）。

- Error / Empty：維持現有結構，僅替換內容區塊。

**可近用（A11y）**

- 抽屜與全屏視圖具備焦點陷阱（Focus Trap）。

- 系統返回鍵支援無障礙聲音提示（Mobile）。

**關聯元件（Frontend）**

- `AppLayout.tsx`（根佈局，管理斷點與模式切換）

- `SideDrawer.tsx`（左欄抽屜）

- `FullScreenDrawer.tsx`（右欄抽屜）

- Skeleton 元件：`LoadingSkeleton.tsx`（含三種版型）

### 3\.3 個人化與狀態管理 (Should-have)

#### 3\.3.1 主題收藏 (Favorites)

**定位（Where）**

- 出現在左欄清單上方區塊，與「趨勢主題」並列。

- 為使用者的個人化追蹤入口。

**內容與樣式（What）**

- 每個主題卡片右上角提供星號按鈕（收藏／取消）。

- 收藏後該主題會出現在左欄「我的收藏」清單。

- 清單內排序固定依照使用者收藏時間（最新在上）。

**互動（How）**

- 點擊星號 → 即時切換收藏狀態並更新 Local Storage。

- 收藏狀態跨會話保存；初次載入時自動載入收藏清單。

- 取消收藏 → 從清單移除並同步更新卡片狀態。

**狀態（Loading / Error / Empty）**

- Loading：初次載入時以骨架卡片呈現收藏區。

- Error：若讀取失敗，顯示「收藏載入失敗」並允許重試。

- Empty：當尚未收藏任何主題時，顯示「尚未有收藏的主題」。

**可近用（A11y）**

- 星號按鈕具 `aria-pressed` 屬性，朗讀為「已收藏／未收藏」。

- 收藏清單卡片有 `aria-label="收藏主題：{name}"`。

**關聯元件（Frontend）**

- `ThemeCard.tsx`（星號按鈕與收藏狀態切換）。

- `Sidebar.tsx`（渲染我的收藏清單）。

- 本地狀態：`useLocalStorage` Hook 保存收藏資料。

#### 3\.3.2 系統狀態反饋 (Loading / Error / Empty)

**定位（Where）**

- 適用於全系統主要清單與面板（左欄主題清單、中欄主題分析、右欄個股詳情）。

- 用於在資料載入、錯誤、或無資料時提供明確回饋。

**內容與樣式（What）**

- **Loading**：

   - 使用骨架屏 (Skeleton)，依照欄位型態呈現（清單骨架、圖表骨架、卡片骨架）。

   - 骨架樣式與最終元素尺寸一致，避免切換跳動。

- **Error**：

   - 顯示錯誤區塊（標示圖示＋錯誤訊息）。

   - 附「重試」按鈕，允許使用者重新請求資料。

- **Empty**：

   - 顯示「暫無資料」文字。

   - 視情境可附建議操作（如「清除篩選」或「稍後再試」）。

- **Loading**

   - 左欄 Trending 清單骨架行數 **= 15**；中/右欄骨架最高佔主要內容 **60% 高度**，避免版面跳動。

   - A11y：容器加 `aria-busy="true"`；骨架元件加 `aria-hidden="true"`。

   **Error**

   - 以 **Toast** 顯示簡訊（不暴露後端細節），提供「**重試**」。

   - 自動重試 **1 次**（退避 **800ms**）；仍失敗則僅提供手動重試。

   - A11y：錯誤提示容器使用 `role="alert"` 以便讀屏即時朗讀。

   - （摘要）錯誤碼對應：`400 invalid_mode → Empty`、`404 no_results → Empty`、`429 rate_limited → Retry`、`500 internal_error → Retry`。\
      ※ 若技術介面章已有完整表，這裡可改為「見〈錯誤碼與契約〉」。

   **Empty**

   - 主標「**暫無資料**」，副標「**請嘗試其他關鍵詞**」。

   - 行動：提供「**重新整理**」與「**清除搜尋**」。

   **Timeout**

   - **3,000ms** 視為逾時，流程同 Error（Toast + Retry）。

**互動（How）**

- 請求開始 → 顯示 Skeleton。

- 請求完成 → 成功則替換實際內容，失敗則顯示錯誤區塊。

- 使用者點擊「重試」 → 重新呼叫同一 API。

- 若錯誤為可恢復型（如網路暫斷），系統可自動退避重試一次。

**可近用（A11y）**

- 錯誤提示帶有 `role="alert"`，讀屏可即時朗讀。

- Skeleton 元件標記為 `aria-hidden="true"`，避免讀屏誤判。

**關聯元件（Frontend）**

- `LoadingSkeleton.tsx`（各型態骨架）。

- `ErrorState.tsx`（錯誤區塊）。

- `EmptyState.tsx`（空狀態）。

- 整合點：`Sidebar.tsx`、`DetailPanel.tsx`、`StockDetailPanel.tsx`。

#### 3\.3.3 情緒／輿情分析（Sentiment Analysis）

**定位（Where）**

- 出現在左欄主題卡片（以簡短情緒條呈現），以及中欄主題分析面板（完整趨勢與來源分佈）。

- 作為市場熱度之外的補充指標。

**內容與樣式（What）**

- **主題卡片**：顯示情緒分數（-1.0 \~ +1.0，轉換為 0–100 百分制），並以顏色條表達（負向冷色，正向暖色）。

- **主題詳情面板**：

   - 顯示近 7 天與 30 天的情緒走勢圖（Sparkline）。

   - 顯示來源比例（新聞 / 社群）。

   - 附帶「最新三則依據」：來源標籤、摘要與時間戳。

- Tooltip：顯示分數細節與來源分佈。

**互動（How）**

- 清單中顯示即時分數；詳情面板 Lazy Load 載入走勢與依據。

- 篩選支援「僅看情緒轉正／轉負」；符合條件的主題會即時收斂。

- 點擊依據摘要 → 在新分頁開啟新聞或社群原文。

**狀態（Loading / Error / Empty）**

- Loading：清單以骨架條呈現；詳情面板的走勢區塊顯示骨架圖。

- Error：顯示錯誤訊息與「重試」按鈕；清單保留上次分數。

- Empty：若暫無相關訊源，顯示「尚無情緒資料」。

**可近用（A11y）**

- 情緒分數以文字顯示，確保非色盲使用者亦可理解。

- 走勢圖提供 aria-label：「近 7 天情緒趨勢」。

**關聯元件（Frontend）**

- `SentimentBar.tsx`（卡片微條顯示）。

- `SentimentSpark.tsx`（詳情走勢圖）。

- `EvidenceList.tsx`（依據列表）。

- 整合點：`ThemeCard.tsx`、`DetailPanel.tsx`。

#### 3\.3.4 異常波動警示（Anomaly Alerting）

**定位（Where）**

- 出現在左欄主題卡片（以徽章或標記提示），以及中欄主題分析面板的異常事件區塊。

- 作為即時提醒市場異常波動的輔助機制。

**內容與樣式（What）**

- **主題卡片**：

   - 顯示異常徽章（如 ▲5%／▼5%／VOL↑2x）。

   - 當多重條件觸發時，僅顯示最嚴重的一項。

- **主題詳情面板**：

   - 顯示異常事件列表（觸發條件、時間戳、代表個股）。

   - 代表個股以簡短清單呈現（名稱＋代號）。

- Tooltip：顯示詳細觸發條件與來源。

**互動（How）**

- 系統偵測主題股群出現異常（漲跌幅或成交量超過預設門檻） → 即時更新 UI。

- 使用者可點擊徽章 → 在詳情面板開啟「異常事件」區塊。

- 詳情事件清單中的個股 → 點擊可直接於右欄開啟個股詳情。

- 閱讀後徽章狀態轉為次要樣式（避免過度干擾）。

**狀態（Loading / Error / Empty）**

- Loading：詳情區塊以骨架卡片顯示事件占位。

- Error：顯示錯誤訊息與「重試」；卡片保留上次狀態。

- Empty：若無事件，詳情區塊隱藏；卡片不顯示徽章。

**可近用（A11y）**

- 異常徽章具備 aria-label：「異常：漲幅超過 5%」等文字描述。

- 事件列表支援鍵盤操作，Enter 可開啟個股詳情。

**關聯元件（Frontend）**

- `AnomalyBadge.tsx`（卡片徽章）。

- `AnomalyPanel.tsx`（詳情事件清單）。

- 整合點：`ThemeCard.tsx`、`DetailPanel.tsx`、`StockDetailPanel.tsx`。

### 3\.4 互動參數與快取

**互動參數（MVP）**

- **Debounce**：`SearchBar` 輸入防抖 **300ms**。

- **Retry**：失敗時最多 **1 次**自動重試（間隔 800ms），之後僅提供手動「重試」。

- **本地快取**：同 `mode+q` 組合在 **60 秒**內命中快取（避免重打 API）。

- **URL 還原**：支援 `?mode=theme|stock&q=...`；返回與重整保留左/中欄滾動位置（已於 3.2.6 規則說明）。

- **Favorites 資料結構**：`localStorage` Key = `favStocks:v1`，內容為 `string[]`（存 `ticker`），上限 100 檔。

## 4\.0 使用者流程 (User Flow)

### 4\.1 探索導向流程 (Irene - 投資新手)

此流程旨在滿足投資新手 Irene 的核心需求：在網站首頁看到當前最熱門的投資主題列表，以便輕鬆探索市場趨勢並學習新知識。

**情境**: Irene 在捷運上看到 YouTuber 提到「光通訊」這個概念，想快速了解這是什麼。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/281da332-d911-4b74-b633-6b1247c807e3#60218b84-0a53-46e5-ae22-9c92d567f459)[\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#7b2a7031-7690-4abc-9c5b-b18723719505,0e7a8a10-591d-447b-8928-9dcc694ad214,ea656887-77ef-42e5-9b09-6d84bbf3917a,fa52516c-8f60-483e-b8b5-7a7f5bc102b5,9c6dcdcc-2830-47ae-b894-af9373d0bc9f,9b629141-5ed5-4e78-8653-01054db05e30,6506ed94-958e-4d1f-bfe1-84c6014e25f8,3c08b321-5cad-49d6-a3bd-a0676334c1e1,e80f0ebd-80fd-4a83-99e1-c5b8b716999f,1369dc9f-b235-4449-a703-56e7bfe9fc44,fc3fcd78-e9e9-40fd-8bc0-9613fb41ad3c)

**步驟 1: 進入首頁**

- **使用者動作 (Irene)**: 在手機上打開網站。

- **系統回應**: 應用程式載入完成。左側邊欄 (Sidebar) 自動載入並顯示當前市場上最熱門的 15 個投資主題。 [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)

**步驟 2: 探索與點擊**

- **使用者動作 (Irene)**: 在左側邊欄的熱門主題列表中瀏覽，找到了「光通訊」並點擊了該主題。

- **系統回應**: 點擊事件觸發了中間主內容區 (Center Main Content) 的更新，系統開始執行對「光通訊」的「主題到個股」搜尋，並顯示載入中狀態。 [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)

**步驟 3: 查看結果**

- **使用者動作 (Irene)**: 在中間內容區塊，看到了「光通訊」的詳細主題卡片 (ThemeCard)，上面有 AI 生成的主題說明、市場熱度條，以及相關的個股列表。 [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)

- **系統回應**: AI 請求完成後，中間內容區塊渲染出完整的分析結果。 [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)

**步驟 4: 收藏主題**

- **使用者動作 (Irene)**: 認為這個主題值得長期追蹤，於是點擊了主題卡片右上角的「星號」圖示。 [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)

- **系統回應**: 該主題被加入 Local Storage，星號圖示變為已收藏狀態。同時，左側邊欄的「我的收藏」清單中立即出現了「光通訊」這個項目，以便她未來快速查找。

### 4\.2 搜尋導向流程 (Kevin - 半專業散戶)

此流程旨在滿足半專業投資者 Kevin 的核心需求：輸入一個市場主題或新聞關鍵字，立即獲得相關股票清單以快速評估機會，並能反向查詢個股以驗證持股邏輯。

**情境**: Kevin 在深夜看到一則財經新聞，提到了「CoWoS」產能緊缺。 [\[2\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/281da332-d911-4b74-b633-6b1247c807e3#60218b84-0a53-46e5-ae22-9c92d567f459)

**步驟 1: 輸入查詢**

- **使用者動作 (Kevin)**: 在頂部的搜尋框中輸入「CoWoS」，並確認搜尋模式為「主題」。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)

- **系統回應**: 搜尋按鈕進入載入中狀態。中間主內容區 (Center Main Content) 更新，顯示載入骨架屏，並呼叫 AI 進行分析。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)[\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#6e8a29b9-d94c-40fe-a153-5770c000bced,9d841f51-e82c-4b51-b147-4a686229f661,0058747b-62f1-4251-afe7-98ed05d67c47,81ef0528-b59e-4235-b4e9-5fbaf7cd89b0)

**步驟 2: 分析結果**

- **使用者動作 (Kevin)**: 在中間主內容區看到「CoWoS」主題的分析結果 (ThemeCard)，他瀏覽了 AI 提供的個股列表，並點擊了其中的「台積電」。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)

- **系統回應**: AI 請求完成後，中間內容區渲染出完整的分析結果。點擊個股的動作觸發了右側詳情面板的顯示。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)[\[5\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#590a8c3a-7069-4797-8565-06af9b78be43,f31dee5c-a27b-45c8-b2c7-84e8918af73c,152b5bd3-01d3-4cba-9436-47a345632321,661fd797-cc70-46e0-ad0d-0abccab8c37b,b6e9848b-0c73-4ceb-8152-81aabcc3266b)

**步驟 3: 查看個股詳情**

- **使用者動作 (Kevin)**: 查看從右側滑入的詳情面板。

- **系統回應**: 右側的「詳情面板 (Detail Panel)」從右側滑入，顯示了 AI 對於「台積電」為何被歸類於 CoWoS 主題的具體原因，同時提供一個直接前往 Yahoo Finance 的外部連結。這個設計讓 Kevin 在查看細節時，不會失去當前搜尋結果的上下文。 [\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#294f7320-e5d3-4c44-8465-b17a12a15dfe,3e1ee345-ccd2-4cba-877d-4620c7381e6f,43dd33f7-b39f-49e9-a738-c2e448bbe206,42f56652-4421-4275-bd39-32adbced93f5,3e5bfe79-3263-44f4-9fbf-54d458f3d829,51ba3cb6-5dac-4f93-bc47-022901287129,ff1c5ed4-278f-482a-8011-848bb0db7b98,46252b87-2ff5-435e-a050-56df25cf1090,64ff4c72-41a4-4903-b159-754a6390ebc3,5c446b12-e5fa-4a25-9f04-5a29fbdf3767,402053c0-c355-45d6-aee0-c07da62dea76)[\[5\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#590a8c3a-7069-4797-8565-06af9b78be43,f31dee5c-a27b-45c8-b2c7-84e8918af73c,152b5bd3-01d3-4cba-9436-47a345632321,661fd797-cc70-46e0-ad0d-0abccab8c37b,b6e9848b-0c73-4ceb-8152-81aabcc3266b)

**步驟 4: 反向驗證**

- **使用者動作 (Kevin)**: 為了進一步驗證，Kevin 在搜尋框切換模式至「個股」，並輸入「2330」或「台積電」進行反向查詢。 [\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#1617d0c2-9119-4468-a911-d7f514a73a52,3f18a152-88fc-4ea6-ac9b-6567f215a939,9a9d1cdd-72a7-437e-b3e8-6b73bb9c9712,c0ace4bf-ad73-4aaf-b989-355e0e38ee47,54e4f1e0-cf42-40e8-a973-d56c812dca4a,c4e917dc-6daa-418c-8b61-cc063aab2b6a)[\[6\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#dc38ea7b-67c5-4e1c-8d2c-715a55cb15f3,5961be08-b121-4b4f-995c-acab534fca7d,b498b79a-a97a-461b-a4c1-b6005f17e4bb,09969677-9b7b-4a3a-9d36-1550cbe27779)

- **系統回應**: 中間主內容區再次更新，顯示出對「台積電」的個股分析結果 (StockAnalysisView)，列出其所屬的所有概念主題，讓 Kevin 可以快速確認「CoWoS」是否如預期地名列其中。

## 5\.0 資料模型 (Data Models)

基於 TypeScript 定義的嚴格資料介面，確保數據一致性與型別安全。 [\[5\]\[6\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#dbfeb293-9da8-410b-8c5f-24d0e482a88d,2cb9a499-4178-4a13-a673-d0ebaf81c1d8,81d5bcee-8a52-40b5-89f4-de737226aa95,de852785-bb2a-4d58-b481-304d65ca3975,39f93352-7117-4365-bbf1-022d49bd164d,60fc90f4-0535-4b28-9fb0-7c084aa70992,7765a42c-3ae6-4a71-ae53-7adde59e7255,638088a0-3989-47bc-ab43-58b935240960)

````ts
// 代表單一股票的結構
interface Stock {
  ticker: string;       // 股票代碼, e.g., "2330"
  name: string;         // 股票名稱, e.g., "台積電"
  exchange: 'TWSE' | 'TPEx'; // 交易所：上市(TWSE)或上櫃(TPEx)
  reason: string;       // AI 分析的入選理由
}

// 代表一個概念主題及其關聯股票的結構 (用於「主題到個股」搜尋)
interface StockConcept {
  id: string;           // 由 uuid 生成的唯一識別碼
  theme: string;        // 主題名稱, e.g., "AI 伺服器"
  description: string;  // 主題的詳細說明
  heatScore: number;    // 市場熱度分數 (0-100)
  stocks: Stock[];      // 該主題下的相關股票陣列
}

// 代表單一股票反向分析結果的結構 (用於「個股到主題」搜尋)
interface StockAnalysisResult {
  stock: { 
    ticker: string;
    name: string;
  };
  themes: ThemeForStock[]; // 該股票所屬的主題陣列
}

// 代表在個股分析中，單一主題的結構
interface ThemeForStock {
  theme: string;        // 主題名稱
  description: string;  // 該股在此主題中的角色與重要性說明
  heatScore: number;    // 市場熱度分數 (0-100)
}```
````

## 6\.0 非功能性需求 (Non-functional Requirements)

### 6\.1 效能 (Performance)

**定位（Where）**

- 適用於前端與後端的資料請求、渲染與快取管理。

- 確保系統在即時性與效能間取得平衡。

**內容與樣式（What）**

- **資料新鮮度**：

   - 主題榜單、熱度、強度：快照有效時間 ≤ 2 小時。

   - 情緒與輿情：快照有效時間 ≤ 2 小時；詳情面板載入時再行更新。

   - 個股歸因：事件導向，來源更新後即反映。

- **前端策略**：

   - 使用 `stale-while-revalidate`：先顯示快取，背景再更新。

   - 清單採分頁或虛擬滾動，減少渲染成本。

   - Lazy Load 模組（情緒走勢、依據列表、個股詳情）。

   - `sessionStorage` 保存本次會話資料，`localStorage` 保存使用者偏好。

- **後端策略**：

   - Edge KV／Cache：榜單、熱度、強度 TTL 5–15 分鐘。

   - API 僅回傳必要欄位；長文摘要僅在詳情請求時傳送。

   - 以 ETag／dataVersion 控制快取同步。

**互動（How）**

- 使用者點擊主題 → 立即顯示快取快照；後台更新完成後自動替換。

- 使用者切換排序／篩選 → 若快取可用則立即顯示；否則顯示骨架並請求新資料。

- 錯誤處理：若最新請求失敗，保留快照並提示「資料更新中」。

**狀態（Loading / Error / Empty）**

- Loading：顯示骨架屏。

- Error：顯示錯誤訊息與「重試」；快取存在時維持舊資料。

- Empty：若無任何快照或結果，顯示「暫無資料」。

**可近用（A11y）**

- 更新提示具 aria-live 區域，讓讀屏用戶得知資料已更新。

**關聯元件（Frontend）**

- `CacheClient.ts`（封裝快取存取與策略）。

- `VirtualList.tsx`（清單渲染）。

- 整合點：`Sidebar.tsx`、`DetailPanel.tsx`、`StockDetailPanel.tsx`。

### 6\.2 可用性與穩定性 (Availability & Stability)

為確保使用者獲得一個可靠且值得信賴的服務，系統必須在可用性、後端穩定性與錯誤處理方面達到以下標準。 

- **系統上線時間 (System Uptime)**

   - **指標**: 網站服務的可用性目標為 \*\*≥ 99.5%\*\*。

   - **達成策略**: 透過將前端部署於 Vercel、API 部署於 Cloudflare Workers 等具備高可用性的 Serverless 平台來達成此目標。

- **後端排程穩定性 (Backend Schedule Stability)**

   - **指標**: 每日自動更新概念股清單的 ETL (Extract, Transform, Load) 排程，其執行成功率必須 \*\*≥ 95%\*\*。

   - **重要性**: 此指標確保了資訊的即時性，是解決使用者手動維護成本高昂痛點的關鍵。

- **錯誤處理 (Error Handling)**

   - **原則**: 系統必須能優雅地處理來自 AI 服務的各種錯誤，並向使用者顯示清晰、易於理解的錯誤訊息，而非程式崩潰或顯示技術性錯誤碼。

   - **處理範圍**:

      - **內容觸發安全過濾器** (response was blocked)。

      - **AI 未能遵循預設的 JSON 格式**。

      - **一般網路或伺服器錯誤**。

- **空狀態 (Empty States)**

   - **原則**: 系統必須為各種「空狀態」提供引導性文案，避免使用者面對空白畫面時感到困惑。

   - **涵蓋場景**:

      - 首次進入網站的歡迎頁面。

      - 收藏清單為空時的引導。

      - 搜尋無結果時的提示。

### 6\.3 安全性 (Security)

**定位（Where）**

- 適用於所有資料收集、儲存與事件上報流程。

- 確保系統遵循隱私規範，避免蒐集或暴露使用者個資。

**內容與樣式（What）**

- **資料收集範圍**：

   - 僅收集匿名事件（如主題開啟、排序切換）。

   - 不收集使用者姓名、Email、帳號等個人識別資訊（PII）。

   - 不記錄完整查詢字串，僅保存查詢長度與模式（主題/個股）。

- **資料保存與傳輸**：

   - 所有事件皆透過 HTTPS 傳輸。

   - 儲存於加密資料庫／Log Service，具備存取權限控管。

   - 應用層快取（localStorage / sessionStorage）不保存敏感資訊。

- **使用者控制**：

   - 提供「資料收集說明」頁面，列出收集範圍與用途。

   - 設置「停用分析」開關（Opt-out），預設為開啟。

- **合規性**：

   - 對齊 GDPR / CCPA 要求，提供查詢與刪除請求管道。

   - 事件資料採匿名 Session ID；不與任何真實身份綁定。

**互動（How）**

- 初次載入 → 顯示隱私條款連結。

- 使用者停用分析 → 不再觸發 Analytics 上報。

- 系統更新隱私政策 → 需提示使用者重新確認。

**狀態（Loading / Error / Empty）**

- Loading / Error 不適用，僅於隱私設定介面顯示狀態切換。

- Empty 狀態為「目前未啟用任何資料收集」。

**可近用（A11y）**

- 隱私設定開關具備 `aria-label="啟用／停用資料收集"`。

- 條款連結可被讀屏朗讀為「開啟隱私政策頁面」。

**關聯元件（Frontend / Backend）**

- 前端：`PrivacyToggle.tsx`（Opt-out 開關）、隱私說明頁。

- 後端：匿名化模組、權限控管、刪除請求 API。

### 6\.4 可及性 (Accessibility)

為了確保身心障礙者也能順利使用本產品，前端開發需遵循網頁內容無障礙指南 (WCAG) 的核心原則，具體要求如下。[\[1\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/8d572272-ea2b-432e-8622-70a339a1b36a#4e9fdf50-b368-4060-a9cb-031ff82925a6,e0728f1e-e925-4ddf-bb10-985f9ecd1a5d,4dceceb6-58df-45d3-8655-3ab238b9ce13,9d0cfdd5-4e89-4e23-a202-970080784e0a)

**定位（Where）**

- 適用於全系統互動元件（搜尋框、清單、卡片、面板、抽屜）。

- 確保使用者在鍵盤操作或使用輔助工具時可順暢瀏覽。

**內容與樣式（What）**

- **焦點管理**：

   - 所有互動元素（按鈕、Chip、卡片、切換器）皆具可見焦點框。

   - 焦點順序依佈局結構排列：左欄 → 中欄 → 右欄。

   - Drawer／Modal 開啟時，焦點限制在容器內；關閉後回到觸發元件。

- **ARIA 標籤**：

   - 搜尋框：`aria-label="主題或個股搜尋"`

   - 熱度條：加上 `aria-valuenow`、`aria-valuemin`、`aria-valuemax`

   - 收藏星號：朗讀「已收藏」／「取消收藏」

   - 排序／篩選：使用 `role="listbox"`、`role="option"` 與 `aria-selected`

- **快捷鍵**：

   - `Ctrl / ⌘ + K`：聚焦全域搜尋框

   - `ESC`：關閉 Drawer、Modal 或右側個股面板

   - `← →`：切換三欄（左清單、中主題、右個股）

   - `↑ ↓`：清單逐項瀏覽

   - `Enter`：開啟聚焦的主題或個股詳情

**狀態（Loading / Error / Empty）**

- Loading：Skeleton 具焦點跳過屬性（`aria-hidden="true"`）。

- Error：錯誤提示附帶 `role="alert"`。

- Empty：提供清楚的文字描述（例如「目前無資料」）。

**可近用（A11y）**

- 所有色彩元素皆提供文字或圖示輔助，確保不僅依顏色判斷。

- 對比度符合 WCAG 2.1 AA（4.5:1）。

**關聯元件（Frontend）**

- `FocusTrap.tsx`（焦點限制）

- `AriaHelpers.tsx`（ARIA 屬性封裝）

- `KeyboardShortcuts.tsx`（快捷鍵綁定與提示）

## 7\.0 範圍界定 (Scope Definition)

### 7\.1 MVP 範圍內 (In-Scope)

包含所有 Must-have 與 Should-have 功能。 [\[7\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#9dab5ab0-8a82-4eee-8a02-b6674631ac4e,c2be41ef-793a-4a84-94aa-91c17a164ce0,45376dca-bc7e-40e9-b683-9717d9c9f662,d2689af8-c45d-497c-a3c6-f4e7984f9884,d605c444-f9f1-4742-9998-d25aab174786,57ec540c-f955-4b9e-841a-6107c70a73c1,da3fa92f-913d-4e9e-aea1-31e39c9210ad,8f147260-441b-4ad5-a2c8-9d010a99ecd8,64899816-4cbc-415d-99c3-87e20b5deb95)

### 7\.2 MVP 範圍外 (Out-of-Scope)

為專注核心價值並加速上線，以下功能在本次迭代中明確排除：

- **會員系統與帳號**: 為貫徹「免登入」的核心使命，導入帳號系統會增加使用者摩擦力。[\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#6d0ebf73-9da5-4f50-92a1-5739ef45c82b,d133653e-8fcb-471b-a3dd-c97ed9679bc8,6d651b74-0445-4f6e-a4dd-499699ee0168,6e4ab228-9b2b-440e-8659-8a2d0c689232)

- **進階圖表與即時股價整合**: MVP 專注於「概念探索」，而非即時交易。詳細數據將透過外部連結提供，以降低開發複雜度。[\[3\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#6d0ebf73-9da5-4f50-92a1-5739ef45c82b,d133653e-8fcb-471b-a3dd-c97ed9679bc8,6d651b74-0445-4f6e-a4dd-499699ee0168,6e4ab228-9b2b-440e-8659-8a2d0c689232)

- **社區交流功能**: 建立社群需額外營運資源，與 MVP 階段專注於工具價值的目標不符。

### 7\.3 未來潛在功能 (Potential Future Enhancements)

MVP 上線後，將根據使用者反饋與數據分析，規劃以下潛在的未來功能：

- 使用者帳號與雲端同步 [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#101ca992-4d1a-4617-b571-133a7e5d26ce,8485dd71-6e81-41af-bdf4-bdd6993a5e63,b61a4a2d-ae72-4536-a7ee-f408095b2737,2480149f-219d-4eec-9c31-0d783206ba88,689253e1-608b-4012-8174-7c95eb09a969)

- 整合即時財經數據 API [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#101ca992-4d1a-4617-b571-133a7e5d26ce,8485dd71-6e81-41af-bdf4-bdd6993a5e63,b61a4a2d-ae72-4536-a7ee-f408095b2737,2480149f-219d-4eec-9c31-0d783206ba88,689253e1-608b-4012-8174-7c95eb09a969)

- 進階過濾與主題比較功能 [\[4\]](https://app.heptabase.com/59be1831-d44b-418b-8c2e-8bd383448194/card/913b1280-8a44-447e-a931-a9de306b926b#101ca992-4d1a-4617-b571-133a7e5d26ce,8485dd71-6e81-41af-bdf4-bdd6993a5e63,b61a4a2d-ae72-4536-a7ee-f408095b2737,2480149f-219d-4eec-9c31-0d783206ba88,689253e1-608b-4012-8174-7c95eb09a969)

- 快取層優化