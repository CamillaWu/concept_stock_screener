name = "concept-stock-screener-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
account_id = "99cf07b95d45a17d7518ef8d87a9e831"

[env.production]
name = "concept-stock-screener-api"

[env.development]
name = "concept-stock-screener-api-development"

# 正式環境設定
[env.production.vars]
ENVIRONMENT = "production"
PINECONE_ENVIRONMENT = "aped-4627-b74a"
PINECONE_INDEX_NAME = "concept-radar"

# 開發環境設定
[env.development.vars]
ENVIRONMENT = "development"
PINECONE_ENVIRONMENT = "aped-4627-b74a"
PINECONE_INDEX_NAME = "concept-radar"

# KV Namespace (共用)
[[kv_namespaces]]
binding = "CONCEPTS_CACHE"
id = "a843b8c636194d0ab4ec21e91e6c63b2"
preview_id = "fccebf8318624229b84f8ae249cbe111"

# 秘密變數（需要在 Cloudflare Dashboard 或 wrangler secret 設定）
# GEMINI_API_KEY
# PINECONE_API_KEY
# CLOUDFLARE_API_TOKEN

# 模組解析配置
[build]
command = "npm run build"

# 外部依賴配置
[build.upload]
format = "modules"

# 處理外部模組
[build.upload.rules]
type = "ESModule"
main = "./dist/index.js"

# 外部依賴排除
[build.upload.exclude]
exclude = [
  "node_modules/@pinecone-database/**",
  "node_modules/@langchain/**",
  "node_modules/langchain/**"
]

# 添加外部依賴配置
[build.upload.external]
external = [
  "@pinecone-database/pinecone",
  "@langchain/google-genai",
  "langchain"
]
